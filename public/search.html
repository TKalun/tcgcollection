<script>
const API_BASE = "https://cf-pages-worker-d1-app.workers.dev";
const token = localStorage.getItem("token");

if (!token) {
  alert("You must log in first!");
  window.location.href = "index.html";
}

document.getElementById("searchForm").addEventListener("submit", async e => {
  e.preventDefault();
  const q = document.getElementById("searchQuery").value;

  const res = await fetch(`${API_BASE}/api/search?q=${encodeURIComponent(q)}`, {
    headers: { "Authorization": `Bearer ${token}` }
  });
  const data = await res.json();

  // Display results
  const resultsDiv = document.getElementById("results");
  if (data.results && data.results.length > 0) {
    resultsDiv.innerHTML = data.results.map(item =>
      `<div><strong>${item.name}</strong><br>${item.description || ""}</div>`
    ).join("");
  } else {
    resultsDiv.innerHTML = "<p>No results found</p>";
  }
});
</script>

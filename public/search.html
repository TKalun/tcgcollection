<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TCGdex Card Search</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .card { margin-top: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; max-width: 400px; }
    .card img { max-width: 100%; border-radius: 8px; }
    .error { color: red; margin-top: 10px; }
  </style>
</head>
<body>
  <!-- Local DB search -->
  <form id="searchForm">
    <input type="text" id="searchQuery" placeholder="Enter local DB search term" required />
    <button type="submit">Search Local DB</button>
  </form>
  <div id="results"></div>

  <h1>TCGdex Card Search</h1>

  <input type="text" id="searchInput" placeholder="Enter card ID (swsh3-136) or name (Charizard)">
  <button onclick="searchCard()">Search</button>

  <div id="result"></div>

  <script>
    const API_BASE = "https://api.tcgdex.net/v2/en";

    // Local DB search (dummy example with hardcoded data for now)
    const localDB = [
      { id: "001", name: "Pikachu", type: "Electric" },
      { id: "002", name: "Charmander", type: "Fire" },
      { id: "003", name: "Squirtle", type: "Water" }
    ];

    document.getElementById("searchForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const query = document.getElementById("searchQuery").value.trim().toLowerCase();
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "";

      const matches = localDB.filter(card =>
        card.name.toLowerCase().includes(query) || card.id.includes(query)
      );

      if (matches.length === 0) {
        resultsDiv.innerHTML = "<p class='error'>No results found in local DB.</p>";
      } else {
        matches.forEach(card => {
          resultsDiv.innerHTML += `<p><strong>${card.name}</strong> (ID: ${card.id}, Type: ${card.type})</p>`;
        });
      }
    });

    // TCGdex search
    async function searchCard() {
      const input = document.getElementById("searchInput").value.trim();
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = "";

      if (!input) {
        resultDiv.innerHTML = "<p class='error'>Please enter a card ID or name.</p>";
        return;
      }

      try {
        let res, data;

        if (input.includes("-")) {
          // Search by card ID
          res = await fetch(`${API_BASE}/cards/${encodeURIComponent(input)}`);
          if (!res.ok) throw new Error("Card not found");
          data = await res.json();
          displayCard(data);
        } else {
          // Search by name
          res = await fetch(`${API_BASE}/cards`);
          if (!res.ok) throw new Error("Failed to fetch card list");
          const allCards = await res.json();
          const matches = allCards.filter(c => c.name.toLowerCase().includes(input.toLowerCase()));

          if (matches.length === 0) throw new Error("No cards found by that name");

          data = matches[0]; // Show first match
          displayCard(data);
        }
      } catch (err) {
        resultDiv.innerHTML = `<p class='error'>${err.message}</p>`;
      }
    }

    function displayCard(data) {
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = `
        <div class="card">
          <h2>${data.name}</h2>
          <p><strong>Set:</strong> ${data.set?.name || "Unknown"}</p>
          <p><strong>Rarity:</strong> ${data.rarity || "Unknown"}</p>
          <img src="${data.image}" alt="${data.name}">
        </div>
      `;
    }
  </script>
</body>
</html>
